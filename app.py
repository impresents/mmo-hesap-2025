import streamlit as st

# --- LOGO VE SAYFA AYARLARI ---
LOGO_URL = "https://makina.mmo.org.tr/assets/img/logo1.png"

st.set_page_config(
    page_title="MMO 2026 Hesapla", 
    page_icon=LOGO_URL,
    layout="centered"
)

# --- ÃœST BÃ–LÃœM: LOGO VE BAÅžLIK ---

# Logonun sabit geniÅŸliÄŸi (Ã–rn: 150 piksel. Ä°stediÄŸiniz gibi deÄŸiÅŸtirebilirsiniz)
st.markdown(
    f"<div style='text-align: center;'><img src='{LOGO_URL}' width='150'></div>", 
    unsafe_allow_html=True
)

st.markdown("<h2 style='text-align: center; color: #333;'>MMO 2026 Proje Hesaplama</h2>", unsafe_allow_html=True)
st.divider()

# --- 2026 VERÄ° TABLOSU ---
PRICE_TABLE = {
    250: [22943, 77031, 135878, 144456, 226478, 290269, 346781, 349917, 362311, 402797, 442044],
    300: [26964, 90750, 160380, 170505, 236463, 303066, 362070, 414183, 428853, 476775, 523230],
    400: [34440, 116500, 206712, 219762, 305762, 391884, 468180, 536998, 556018, 618150, 678380],
    500: [41160, 140000, 249480, 265230, 370300, 474600, 567000, 652190, 675290, 750750, 823900],
    600: [47124, 161250, 288684, 306909, 430077, 551214, 658530, 759759, 786669, 874575, 959790],
    700: [52332, 180250, 324324, 344799, 485093, 621726, 742770, 859705, 890155, 989625, 1086050],
    800: [56784, 197000, 356400, 378900, 535348, 686136, 819720, 952028, 985748, 1095900, 1202680],
    900: [60480, 211500, 384912, 409212, 580842, 744444, 889380, 1036728, 1073448, 1193400, 1309680],
    1000: [63420, 223750, 409860, 435735, 621575, 796650, 951750, 1113805, 1153255, 1282125, 1407050],
    1500: [88830, 313125, 571725, 607819, 866899, 1111073, 1327388, 1550010, 1604910, 1784250, 1958100],
    2000: [110040, 386250, 704880, 749380, 1068580, 1369560, 1636200, 1905750, 1973250, 2193750, 2407500],
    2500: [127050, 443750, 809325, 860419, 1223313, 1567875, 1873125, 2181025, 2258275, 2510625, 2755250],
    3000: [146790, 513750, 932580, 991455, 1408463, 1805175, 2156625, 2509238, 2598113, 2888438, 3169875],
    3500: [165375, 575313, 1042965, 1108809, 1573775, 2017050, 2409750, 2794041, 2893004, 3216281, 3529663],
    4000: [181440, 632500, 1140480, 1212480, 1713960, 2196720, 2624400, 3049200, 3157200, 3510000, 3852000],
    4500: [197505, 680625, 1225125, 1302469, 1838936, 2356898, 2815763, 3258833, 3374258, 3751313, 4116825],
    5000: [210000, 721875, 1296900, 1378775, 1937463, 2483175, 2966625, 3430350, 3551850, 3948750, 4333500],
    6000: [241920, 828750, 1485000, 1578750, 2213865, 2837430, 3389850, 3913140, 4051740, 4504500, 4943400],
    7000: [270480, 923125, 1649340, 1753465, 2462495, 3156090, 3770550, 4328170, 4481470, 4982250, 5467700],
    8000: [297360, 1015000, 1805760, 1919760, 2687320, 3444240, 4114800, 4726260, 4893660, 5440500, 5970600],
    9000: [326970, 1108125, 1969110, 2093423, 2928015, 3752730, 4483350, 5145525, 5327775, 5923125, 6500250],
    10000: [354900, 1193750, 2128500, 2262875, 3081425, 3949350, 4718250, 5526675, 5722425, 6361875, 6981750],
    12500: [412125, 1398438, 2475000, 2631250, 3653406, 4682438, 5594063, 6405438, 6632313, 7373438, 8091875],
    15000: [469350, 1575000, 2776950, 2952263, 4106362, 5262975, 6287625, 7210088, 7465463, 8299688, 9108375],
    17500: [518175, 1728125, 3049200, 3241700, 4489888, 5754525, 6874875, 7855925, 8134175, 9043125, 9924250],
    20000: [562800, 1887500, 3306600, 3515350, 4866800, 6237600, 7452000, 8470000, 8770000, 9750000, 10700000],
    22500: [604800, 2010938, 3497175, 3717956, 5147831, 6597788, 7882313, 8957025, 9274275, 10310625, 11315250],
    25000: [640500, 2109375, 3712500, 3946875, 5422250, 6949500, 8302500, 9475813, 9811438, 10907813, 11970625],
    27500: [669900, 2217188, 3865950, 4110013, 5637156, 7224938, 8631563, 9782850, 10129350, 11261250, 12358500],
    30000: [693000, 2287500, 4009500, 4262625, 5832225, 7474950, 8930250, 10227525, 10589775, 11773125, 12920250],
    32500: [716625, 2396875, 4214925, 4481019, 6189300, 7932600, 9477000, 10804544, 11187231, 12437344, 13649188],
    35000: [742350, 2493750, 4365900, 4641525, 6433963, 8246175, 9851625, 11190988, 11587363, 12882188, 14137375],
    37500: [771750, 2578125, 4529250, 4815188, 6645563, 8517375, 10175625, 11593313, 12003938, 13345313, 14645625],
    40000: [798000, 2675000, 4672800, 4967800, 6877000, 8814000, 10530000, 11942700, 12365700, 13747500, 15087000],
    42500: [821100, 2762500, 4838625, 5144094, 7081988, 9076725, 10843875, 12329144, 12765831, 14192344, 15575188],
    45000: [841050, 2840625, 4945050, 5257238, 7320038, 9381825, 11208375, 12673238, 13122113, 14588438, 16009875],
    47500: [867825, 2909375, 5078700, 5399325, 7475431, 9580988, 11446313, 13075563, 13538688, 15051563, 16518125],
    50000: [892500, 3000000, 5197500, 5525625, 7670500, 9831000, 11745000, 13340250, 13812750, 15356250, 16852500],
    55000: [935550, 3128125, 5445000, 5788750, 8073863, 10347975, 12362625, 13975500, 14470500, 16087500, 17655000],
    60000: [970200, 3262500, 5702400, 6062400, 8411100, 10780200, 12879000, 14610750, 15128250, 16818750, 18457500],
    65000: [1010100, 3412500, 5984550, 6362363, 8768175, 11237850, 13425750, 15277763, 15818888, 17586563, 19300125],
    70000: [1058400, 3543750, 6167700, 6557075, 9072350, 11627700, 13891500, 15860075, 16421825, 18256875, 20035750],
    75000: [1086750, 3656250, 6385500, 6788625, 9422813, 12076875, 14428125, 16357688, 16937063, 18829688, 20664375],
    80000: [1125600, 3750000, 6573600, 6988600, 9733600, 12475200, 14904000, 16940000, 17540000, 19500000, 21400000]
}

CLASSES = ["1.SINIF", "2.SINIF", "3A", "3B", "4A", "4B", "4C", "5A", "5B", "5C", "5D"]

def get_interpolated_price(area, class_idx):
    sorted_areas = sorted(PRICE_TABLE.keys())
    
    # 250 mÂ² altÄ±ndakiler iÃ§in 0 ile ilk deÄŸer (250) arasÄ±nda doÄŸrusal orantÄ± (Enterpolasyon)
    if area <= sorted_areas[0]: 
        return (area / sorted_areas[0]) * PRICE_TABLE[sorted_areas[0]][class_idx]
        
    if area >= sorted_areas[-1]: 
        return PRICE_TABLE[sorted_areas[-1]][class_idx]
        
    for i in range(len(sorted_areas)-1):
        a_alt, a_ust = sorted_areas[i], sorted_areas[i+1]
        if a_alt <= area <= a_ust:
            v_alt, v_ust = PRICE_TABLE[a_alt][class_idx], PRICE_TABLE[a_ust][class_idx]
            return v_alt + (area - a_alt) * (v_ust - v_alt) / (a_ust - a_alt)
            
    return 0

# --- GÄ°RDÄ°LER ---
area = st.number_input("Ä°nÅŸaat AlanÄ± (mÂ²)", value=1000, step=1)
cls = st.selectbox("YapÄ± SÄ±nÄ±fÄ±", CLASSES, index=2)
tips = st.number_input("Bina Adedi", value=1, min_value=1)
discount_pct = st.slider("Ä°ndirim OranÄ± (%)", min_value=0, max_value=100, value=0)

if st.button("HESAPLA", use_container_width=True):
    table_price = get_interpolated_price(area, CLASSES.index(cls))
    m = [1.0, 0.5, 0.25] + [0.15] * max(0, tips - 3)
    multiplier = sum(m[:tips])
    
    u_brut = table_price * multiplier
    r_brut = u_brut * 0.5
    pay_ratio = (100 - discount_pct) / 100.0

    st.divider()
    c_left, c_right = st.columns(2)
    with c_left:
        st.metric("Ruhsat", f"{round(r_brut):,} TL")
    with c_right:
        st.metric("Uygulama", f"{round(u_brut):,} TL")

    st.markdown("### ðŸ”¹ Ä°ndirimli SonuÃ§lar (KDV Dahil)")
    
    matrah_r = round(r_brut * pay_ratio)
    kdv_r = round(matrah_r * 0.2)
    st.info(f"**RUHSAT PROJE BEDELÄ°**\n\nFiyat: {matrah_r:,} TL  +  KDV: {kdv_r:,} TL\n\n**TOPLAM: {matrah_r + kdv_r:,} TL**")

    matrah_u = round(u_brut * pay_ratio)
    kdv_u = round(matrah_u * 0.2)
    st.error(f"**UYGULAMA PROJE BEDELÄ°**\n\nFiyat: {matrah_u:,} TL  +  KDV: {kdv_u:,} TL\n\n**TOPLAM: {matrah_u + kdv_u:,} TL**")

# --- YAPIMCI VE SORUMLULUK REDDÄ° (ALT BÄ°LGÄ°) ---
st.markdown("<br><hr>", unsafe_allow_html=True)
st.markdown(
    """
    <div style='text-align: center; color: gray; font-size: 0.8em;'>
        Bu program <b>Mehmet SUNAR</b> tarafÄ±ndan hazÄ±rlanmÄ±ÅŸtÄ±r.<br>
        Hesaplamalar Bilgilendirme AmaÃ§lÄ±dÄ±r; Resmi Ä°ÅŸlemlerde MMO Verileri EsastÄ±r.<br>
        Hesaplamalardan Kaynaklanabilecek Hatalardan Sorumluluk Kabul Edilmez.
    </div>
    """, 
    unsafe_allow_html=True
)
